<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Twig by vyo</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Twig</h1>
        <p class="header">Minimal bunyan-style logging for Kotlin and the JVM</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/vyo/twig/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/vyo/twig/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/vyo/twig">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/vyo">vyo</a></p>


      </header>
      <section>
        <h1>
<a id="twig" class="anchor" href="#twig" aria-hidden="true"><span class="octicon octicon-link"></span></a>Twig</h1>

<p>Opinionated minimal logging inspired by and compatible with <a href="https://github.com/trentm/node-bunyan">node-bunyan</a></p>

<hr>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>JSON formatted, <a href="https://github.com/trentm/node-bunyan">bunyan</a>-conformant log entries</li>
<li>asynchronous logging, powered by <a href="http://kovenant.komponents.nl/">Kovenant</a> and <a href="https://lmax-exchange.github.io/disruptor/">Disruptor</a>
</li>
<li>console only by default</li>
<li>easily extendable and customisable via simple Appender interface</li>
<li>startup configuration via optional environment variables</li>
</ul>

<h3>
<a id="basic" class="anchor" href="#basic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic</h3>

<p>Having a TestObject</p>

<div class="highlight highlight-source-Kotlin"><pre>object <span class="pl-en">TestObject</span> {
    <span class="pl-k">val</span> <span class="pl-en">logger</span><span class="pl-k">:</span> Logger <span class="pl-k">=</span> Logger(<span class="pl-c1">this</span>)

    <span class="pl-k">fun</span> <span class="pl-en">dummyFunction</span>() {
        logger<span class="pl-k">.</span>info(<span class="pl-s"><span class="pl-pds">"</span>dummy<span class="pl-pds">"</span></span>)
    }
}</pre></div>

<p>and calling its <code>dummyFunction</code> will result in a log entry similar to</p>

<div class="highlight highlight-source-json"><pre>{<span class="pl-s"><span class="pl-pds">"</span>hostname<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>vyo-pc<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>pid<span class="pl-pds">"</span></span>:<span class="pl-c1">6484</span>,<span class="pl-s"><span class="pl-pds">"</span>thread<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>Thread[main,5,]<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>time<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>2015-11-30T18:55:35.092Z<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>level<span class="pl-pds">"</span></span>:<span class="pl-c1">30</span>,<span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>io.github.vyo.twig.TestObject@12aba81<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>msg<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>dummy<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>v<span class="pl-pds">"</span></span>:<span class="pl-c1">0</span>}</pre></div>

<h3>
<a id="custom-fields" class="anchor" href="#custom-fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Fields</h3>

<p>You may pass in an arbitrary number of <code>Pair&lt;String, Any&gt;</code> to create additional custom log entry fields</p>

<pre><code>logger.info("dummy", Pair("my custom field", "my custom content"), Pair("my logger", logger))
</code></pre>

<pre><code>{"hostname":"vyo-pc","pid":6156,"thread":"Thread[main,5,]","time":"2015-11-30T19:09:58.507Z","level":30,"name":"io.github.vyo.twig.TestObject@16e898f","msg":"dummy","my custom field":"my custom content","my logger":"io.github.vyo.twig.logger.Logger@1a97992","v":0}
</code></pre>

<h3>
<a id="bunyan-cli" class="anchor" href="#bunyan-cli" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bunyan CLI</h3>

<p>Piped into the bunyan cli the preceding log entry will be pretty-printed like this</p>

<pre><code>[2015-11-30T19:09:58.507Z]  INFO: io.github.vyo.twig.TestObject@16e898f/6156 on vyo-pc: dummy (thread=Thread[main,5,], my custom field="my custom content", my logger=io.github.vyo.twig.logger.Logger@1a97992)
</code></pre>

<h3>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>The configuration is logged on startup; by default the global log level will be INFO, the worker amount will be set to the system's available processors and the log queue size to 1024</p>

<pre><code>{"hostname":"vyo-pc","pid":1144,"thread":"Thread[main,5,]","time":"2015-11-30T19:36:28.220Z","level":30,"name":"twig","msg":"logging worker count: 4","v":0}
{"hostname":"vyo-pc","pid":1144,"thread":"Thread[main,5,]","time":"2015-11-30T19:36:28.220Z","level":30,"name":"twig","msg":"logging work queue size: 1024","v":0}
{"hostname":"vyo-pc","pid":1144,"thread":"Thread[main,5,]","time":"2015-11-30T19:36:28.220Z","level":30,"name":"twig","msg":"global log level: INFO","v":0}
</code></pre>

<p>Setting up the following environment variables in advance</p>

<div class="highlight highlight-source-shell"><pre>TWIG_LEVEL=TRACE
TWIG_QUEUE=64
TWIG_WORKERS=1</pre></div>

<pre><code>{"hostname":"vyo-pc"","pid":6580,"thread":"Thread[main,5,]","time":"2015-11-30T19:38:45.037Z","level":30,"name":"twig","msg":"global log level TRACE","v":0}
{"hostname":"vyo-pc"","pid":6580,"thread":"Thread[main,5,]","time":"2015-11-30T19:38:45.037Z","level":30,"name":"twig","msg":"logging work queue size: 64","v":0}
{"hostname":"vyo-pc"","pid":6580,"thread":"Thread[main,5,]","time":"2015-11-30T19:38:45.037Z","level":30,"name":"twig","msg":"logging worker count: 1","v":0}
</code></pre>

<p>Re-assigning the global log level or appender will also be logged</p>

<pre><code>Logger.global.appender = ConsoleAppender()
Logger.global.level = Level.WARN
</code></pre>

<pre><code>{"hostname":"vyo-pc"","pid":6364,"thread":"Thread[main,5,]","time":"2015-11-30T19:40:36.876Z","level":30,"name":"twig","msg":"global appender io.github.vyo.twig.appender.ConsoleAppender@1ae6ba4","v":0}
{"hostname":"vyo-pc"","pid":6364,"thread":"Thread[main,5,]","time":"2015-11-30T19:40:36.876Z","level":30,"name":"twig","msg":"global log level WARN","v":0}
</code></pre>

<h3>
<a id="exception-behaviour" class="anchor" href="#exception-behaviour" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exception Behaviour</h3>

<p>If an exception occurs during the actual logging process, e.g. because the underlying Appender fails, we try to log a diagnostic entry to STDERR</p>

<pre><code>logger.fatal("exceptional")
</code></pre>

<pre><code>{"hostname":"vyo-pc","pid":3092,"thread":"Thread[main,5,]","time":"2015-11-30T19:47:15.128Z","level":60"name":"io.github.vyo.twig.logger.Logger@50ea2a","msg":"logging failed: null","original level":30,"original name":"io.github.vyo.twig.TestObject@970b10","original message":"exceptional","v":0
</code></pre>

<h2>
<a id="notes" class="anchor" href="#notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Notes</h2>

<p>This project adheres to the <a href="http://semver.org/">semantic versioning</a> and <a href="http://keepachangelog.com/">change log</a> guidelines.</p>

<h2>
<a id="author" class="anchor" href="#author" aria-hidden="true"><span class="octicon octicon-link"></span></a>Author</h2>

<p>Manuel Weidmann (<a href="https://github.com/vyo" class="user-mention">@vyo</a>)</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>MIT License</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
